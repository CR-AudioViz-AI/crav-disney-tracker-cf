<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Deal Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè∞</text></svg>">
    <style>
        .clickable { cursor: pointer; transition: all 0.2s ease; }
        .clickable:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        .deal-card:hover { background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 100%); }
        .stat-card:hover { transform: scale(1.03); }
        .calendar-day.has-deals { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); cursor: pointer; font-weight: 600; }
        .calendar-day.has-deals:hover { transform: scale(1.15); box-shadow: 0 4px 12px rgba(34,197,94,0.4); }
        .modal-overlay { opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { transform: scale(0.9) translateY(20px); transition: all 0.3s ease; }
        .modal-overlay.active .modal-content { transform: scale(1) translateY(0); }
        .filter-btn.active { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; }
        .tab-btn.active { background: white; color: #3b82f6; border-bottom: 3px solid #3b82f6; }
        .hotel-card:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(0,0,0,0.12); }
        .nav-btn:hover { background: #e5e7eb; }
        .secret-card { background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%); }
        .secret-card:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(99,102,241,0.4); }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .glow { box-shadow: 0 0 20px rgba(234,179,8,0.5); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 text-white shadow-xl">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-3xl font-bold">üè∞ Disney Deal Tracker</h1>
                    <p class="text-blue-100 mt-1">Current deals + Hotel booking secrets</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="refreshDeals()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-medium transition flex items-center gap-2">
                        <span id="refresh-icon">üîÑ</span> Refresh
                    </button>
                    <button onclick="showSecretsTab()" class="bg-yellow-400 hover:bg-yellow-300 text-yellow-900 px-4 py-2 rounded-lg font-bold transition glow">
                        üîì Deal Hunter
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex gap-1">
                <button onclick="showTab('deals')" class="tab-btn active px-6 py-4 font-medium text-gray-600 transition" data-tab="deals">üî• Deals</button>
                <button onclick="showTab('hotels')" class="tab-btn px-6 py-4 font-medium text-gray-600 transition" data-tab="hotels">üè® Hotels</button>
                <button onclick="showTab('calendar')" class="tab-btn px-6 py-4 font-medium text-gray-600 transition" data-tab="calendar">üìÖ Calendar</button>
                <button onclick="showSecretsTab()" class="tab-btn px-6 py-4 font-medium text-yellow-600 transition" data-tab="secrets">üîì Secrets</button>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <div onclick="filterDeals('all')" class="stat-card clickable bg-white rounded-xl shadow-lg p-5 text-center border-t-4 border-blue-500">
                <div class="text-4xl font-bold text-blue-600" id="total-deals">-</div>
                <div class="text-gray-500 text-sm mt-1">Active Deals</div>
            </div>
            <div onclick="showBestDeal()" class="stat-card clickable bg-white rounded-xl shadow-lg p-5 text-center border-t-4 border-green-500">
                <div class="text-4xl font-bold text-green-600" id="best-discount">-</div>
                <div class="text-gray-500 text-sm mt-1">Best Discount</div>
            </div>
            <div onclick="showResortPicker()" class="stat-card clickable bg-white rounded-xl shadow-lg p-5 text-center border-t-4 border-purple-500">
                <div class="text-4xl font-bold text-purple-600" id="resorts-count">-</div>
                <div class="text-gray-500 text-sm mt-1">Resorts</div>
            </div>
            <div onclick="showSecretsTab()" class="stat-card clickable bg-gradient-to-r from-yellow-400 to-orange-500 rounded-xl shadow-lg p-5 text-center">
                <div class="text-4xl font-bold text-white">üîì</div>
                <div class="text-white/90 text-sm mt-1 font-semibold">Deal Hunter</div>
            </div>
        </div>

        <!-- DEALS TAB -->
        <div id="deals-tab" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-4">
                        <div class="flex flex-wrap gap-2" id="filter-buttons"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b flex justify-between items-center">
                            <h2 class="text-xl font-bold text-gray-800">üî• Current Deals</h2>
                            <span class="text-sm text-gray-500" id="showing-count">Loading...</span>
                        </div>
                        <div id="deals-container" class="divide-y"></div>
                    </div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-4 py-3 border-b">
                            <div class="flex items-center justify-between">
                                <button onclick="changeMiniMonth(-1)" class="nav-btn w-8 h-8 flex items-center justify-center rounded-full text-gray-600">‚Üê</button>
                                <h2 class="text-lg font-bold text-gray-800" id="calendar-month"></h2>
                                <button onclick="changeMiniMonth(1)" class="nav-btn w-8 h-8 flex items-center justify-center rounded-full text-gray-600">‚Üí</button>
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="grid grid-cols-7 gap-1 text-center text-xs font-semibold text-gray-500 mb-2">
                                <div>Su</div><div>Mo</div><div>Tu</div><div>We</div><div>Th</div><div>Fr</div><div>Sa</div>
                            </div>
                            <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b">
                            <h2 class="text-lg font-bold text-gray-800">üè® Deals by Resort</h2>
                        </div>
                        <div class="divide-y" id="resort-stats"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HOTELS TAB -->
        <div id="hotels-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-purple-500 px-6 py-6 text-white">
                    <h2 class="text-2xl font-bold mb-2">üè® Book Disney Area Hotels</h2>
                    <p class="text-blue-100">Click any hotel to check real availability</p>
                </div>
                <div class="p-6">
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="filterHotels('all')" class="hotel-filter active px-4 py-2 rounded-full font-medium bg-blue-500 text-white" data-cat="all">All</button>
                        <button onclick="filterHotels('disney')" class="hotel-filter px-4 py-2 rounded-full font-medium bg-gray-200 text-gray-700" data-cat="disney">üè∞ Disney</button>
                        <button onclick="filterHotels('partner')" class="hotel-filter px-4 py-2 rounded-full font-medium bg-gray-200 text-gray-700" data-cat="partner">ü§ù Partner</button>
                        <button onclick="filterHotels('budget')" class="hotel-filter px-4 py-2 rounded-full font-medium bg-gray-200 text-gray-700" data-cat="budget">üí∞ Budget</button>
                    </div>
                    <div id="hotels-container" class="space-y-4"></div>
                </div>
            </div>
        </div>

        <!-- CALENDAR TAB -->
        <div id="calendar-tab" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">üìÖ Deal Calendar</h2>
                    <div class="flex gap-2">
                        <button onclick="changeMonth(-1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">‚Üê Prev</button>
                        <button onclick="goToTodayFull()" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg">Today</button>
                        <button onclick="changeMonth(1)" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Next ‚Üí</button>
                    </div>
                </div>
                <div class="p-6">
                    <h3 id="full-calendar-month" class="text-2xl font-bold text-center mb-6"></h3>
                    <div class="grid grid-cols-7 gap-2 text-center font-semibold text-gray-600 mb-4">
                        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                    </div>
                    <div id="full-calendar-grid" class="grid grid-cols-7 gap-2"></div>
                </div>
            </div>
        </div>

        <!-- üîì SECRETS TAB - DEAL HUNTER PRO -->
        <div id="secrets-tab" class="tab-content hidden">
            <!-- Password Gate -->
            <div id="secrets-gate" class="max-w-md mx-auto">
                <div class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-2xl shadow-2xl p-8 text-white text-center">
                    <div class="text-6xl mb-4">üîê</div>
                    <h2 class="text-2xl font-bold mb-2">Deal Hunter Pro</h2>
                    <p class="text-purple-200 mb-6">Private access for Roy & Cindy</p>
                    <input type="password" id="secrets-password" placeholder="Enter password" 
                        class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 mb-4 text-center text-lg"
                        onkeypress="if(event.key==='Enter')unlockSecrets()">
                    <button onclick="unlockSecrets()" class="w-full bg-yellow-400 hover:bg-yellow-300 text-yellow-900 font-bold py-3 rounded-lg transition">
                        üîì Unlock Secrets
                    </button>
                    <p id="password-error" class="text-red-300 mt-3 hidden">Wrong password. Try again.</p>
                </div>
            </div>

            <!-- Unlocked Content -->
            <div id="secrets-content" class="hidden space-y-6">
                <!-- Magic Hour Countdown -->
                <div class="bg-gradient-to-r from-amber-500 to-orange-600 rounded-2xl shadow-xl p-6 text-white">
                    <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                        <div>
                            <h2 class="text-2xl font-bold flex items-center gap-2">
                                <span class="pulse-dot">‚è∞</span> Magic Hour Countdown
                            </h2>
                            <p class="text-amber-100">Hotels drop prices at 4:00 PM Orlando time to fill empty rooms</p>
                        </div>
                        <div class="text-center">
                            <div id="magic-hour-countdown" class="text-4xl font-mono font-bold">--:--:--</div>
                            <div class="text-amber-200 text-sm">until 4:00 PM EST</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Hunt Buttons -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <a href="https://www.priceline.com/stay/search/hotels/?rooms=1&adults=2&destination=Walt%20Disney%20World%2C%20FL&express=1" target="_blank" rel="noopener"
                        class="secret-card rounded-xl p-6 text-white clickable block">
                        <div class="flex items-center gap-4">
                            <div class="text-4xl">üéØ</div>
                            <div>
                                <h3 class="text-xl font-bold">Priceline Express Deals</h3>
                                <p class="text-indigo-200">Pre-filtered for Disney World area</p>
                                <p class="text-yellow-300 text-sm mt-1">üí° Best for Disney resort inventory</p>
                            </div>
                        </div>
                    </a>
                    <a href="https://www.hotwire.com/hotels/search?destination=Walt%20Disney%20World%2C%20FL" target="_blank" rel="noopener"
                        class="secret-card rounded-xl p-6 text-white clickable block">
                        <div class="flex items-center gap-4">
                            <div class="text-4xl">üî•</div>
                            <div>
                                <h3 class="text-xl font-bold">Hotwire Hot Rates</h3>
                                <p class="text-indigo-200">Mystery deals with amenity reveals</p>
                                <p class="text-yellow-300 text-sm mt-1">üí° Shows more hotel details upfront</p>
                            </div>
                        </div>
                    </a>
                </div>

                <!-- Reveal Tools -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-4 text-white">
                        <h2 class="text-xl font-bold">üîç Reveal the Mystery Hotel BEFORE Booking</h2>
                        <p class="text-emerald-100 text-sm">Use these tools to identify which hotel you're getting</p>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <a href="https://roomrevealer.com/orlando_fl/" target="_blank" rel="noopener"
                            class="border-2 border-emerald-200 hover:border-emerald-400 rounded-xl p-4 text-center transition">
                            <div class="text-3xl mb-2">üîÆ</div>
                            <h3 class="font-bold text-gray-800">RoomRevealer</h3>
                            <p class="text-gray-500 text-sm">Auto-reveals Hotwire/Priceline</p>
                        </a>
                        <a href="https://www.betterbidding.com/index.php?showforum=79" target="_blank" rel="noopener"
                            class="border-2 border-emerald-200 hover:border-emerald-400 rounded-xl p-4 text-center transition">
                            <div class="text-3xl mb-2">üë•</div>
                            <h3 class="font-bold text-gray-800">BetterBidding</h3>
                            <p class="text-gray-500 text-sm">22,000+ member forum</p>
                        </a>
                        <a href="https://www.hoteldealsrevealed.com/hotelinventory/hotwire/fl/orlando" target="_blank" rel="noopener"
                            class="border-2 border-emerald-200 hover:border-emerald-400 rounded-xl p-4 text-center transition">
                            <div class="text-3xl mb-2">üìã</div>
                            <h3 class="font-bold text-gray-800">HotelDealsRevealed</h3>
                            <p class="text-gray-500 text-sm">Crowdsourced hotel lists</p>
                        </a>
                    </div>
                </div>

                <!-- Disney Resort Identification Guide -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4 text-white">
                        <h2 class="text-xl font-bold">üè∞ How to Identify Disney Resorts on Priceline/Hotwire</h2>
                    </div>
                    <div class="p-6">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-left font-bold">Star Rating</th>
                                        <th class="px-4 py-3 text-left font-bold">Location</th>
                                        <th class="px-4 py-3 text-left font-bold">Key Indicators</th>
                                        <th class="px-4 py-3 text-left font-bold">Likely Resort</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y">
                                    <tr class="hover:bg-blue-50">
                                        <td class="px-4 py-3"><span class="bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">3 ‚≠ê</span></td>
                                        <td class="px-4 py-3">Bonnet Creek</td>
                                        <td class="px-4 py-3">Airport shuttle, No resort fee, Free parking</td>
                                        <td class="px-4 py-3 font-semibold text-blue-600">Value Resort (Pop Century, All-Stars, Art of Animation)</td>
                                    </tr>
                                    <tr class="hover:bg-purple-50">
                                        <td class="px-4 py-3"><span class="bg-purple-100 text-purple-700 px-2 py-1 rounded font-bold">3.5 ‚≠ê</span></td>
                                        <td class="px-4 py-3">Bonnet Creek</td>
                                        <td class="px-4 py-3">Airport shuttle, No resort fee</td>
                                        <td class="px-4 py-3 font-semibold text-purple-600">Moderate (Caribbean Beach, Coronado, Port Orleans)</td>
                                    </tr>
                                    <tr class="hover:bg-amber-50">
                                        <td class="px-4 py-3"><span class="bg-amber-100 text-amber-700 px-2 py-1 rounded font-bold">4 ‚≠ê</span></td>
                                        <td class="px-4 py-3">Bonnet Creek</td>
                                        <td class="px-4 py-3">Airport shuttle, "Lodge" in name</td>
                                        <td class="px-4 py-3 font-semibold text-amber-600">Deluxe (Grand Floridian, Polynesian, Wilderness Lodge, AKL)</td>
                                    </tr>
                                    <tr class="hover:bg-green-50">
                                        <td class="px-4 py-3"><span class="bg-green-100 text-green-700 px-2 py-1 rounded font-bold">4 ‚≠ê</span></td>
                                        <td class="px-4 py-3">Bonnet Creek</td>
                                        <td class="px-4 py-3">HAS resort fee ($35-45)</td>
                                        <td class="px-4 py-3 font-semibold text-green-600">Swan & Dolphin (still great - walk to Epcot!)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p class="text-yellow-800 font-medium">üéØ KEY RULE: If it says "NO RESORT FEE" and is in Bonnet Creek area, it's almost certainly a Disney-owned resort!</p>
                        </div>
                    </div>
                </div>

                <!-- Timing Secrets -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-pink-500 to-rose-500 px-6 py-4 text-white">
                        <h2 class="text-xl font-bold">‚è∞ Timing Secrets (Research-Backed)</h2>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-gradient-to-br from-pink-50 to-rose-50 rounded-xl p-4 text-center">
                                <div class="text-3xl font-bold text-rose-600">15 days</div>
                                <div class="text-gray-600 text-sm">before arrival = 13% savings</div>
                                <div class="text-gray-400 text-xs mt-1">vs booking 4 months out</div>
                            </div>
                            <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-xl p-4 text-center">
                                <div class="text-3xl font-bold text-amber-600">4:00 PM</div>
                                <div class="text-gray-600 text-sm">"Magic Hour" for deals</div>
                                <div class="text-gray-400 text-xs mt-1">Hotels drop prices then</div>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 text-center">
                                <div class="text-3xl font-bold text-emerald-600">Sunday</div>
                                <div class="text-gray-600 text-sm">check-in = 9% cheaper</div>
                                <div class="text-gray-400 text-xs mt-1">vs Friday check-in</div>
                            </div>
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-4 text-center">
                                <div class="text-3xl font-bold text-indigo-600">Tuesday</div>
                                <div class="text-gray-600 text-sm">booking = 16% savings</div>
                                <div class="text-gray-400 text-xs mt-1">vs Friday booking</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Deal Log -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-slate-700 to-slate-800 px-6 py-4 text-white flex justify-between items-center">
                        <div>
                            <h2 class="text-xl font-bold">üìù Your Deal Log</h2>
                            <p class="text-slate-300 text-sm">Track deals you find for comparison</p>
                        </div>
                        <button onclick="addDealLog()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">+ Add Deal</button>
                    </div>
                    <div class="p-6">
                        <div id="deal-log-container" class="space-y-3">
                            <p class="text-gray-400 text-center py-8" id="no-logs">No deals logged yet. Click "Add Deal" when you find one!</p>
                        </div>
                    </div>
                </div>

                <!-- Current Availability (Manual Check Links) -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gradient-to-r from-cyan-500 to-blue-500 px-6 py-4 text-white">
                        <h2 class="text-xl font-bold">üîé Quick Availability Checks</h2>
                        <p class="text-cyan-100 text-sm">One-click links to check each Disney resort</p>
                    </div>
                    <div class="p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <a href="https://disneyworld.disney.go.com/resorts/pop-century-resort/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üé¨</span>
                            <div><div class="font-semibold">Pop Century</div><div class="text-xs text-gray-500">Value ‚Ä¢ From $169</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/art-of-animation-resort/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üé®</span>
                            <div><div class="font-semibold">Art of Animation</div><div class="text-xs text-gray-500">Value ‚Ä¢ From $189</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/caribbean-beach-resort/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üèùÔ∏è</span>
                            <div><div class="font-semibold">Caribbean Beach</div><div class="text-xs text-gray-500">Moderate ‚Ä¢ From $249</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/coronado-springs-resort/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üåµ</span>
                            <div><div class="font-semibold">Coronado Springs</div><div class="text-xs text-gray-500">Moderate ‚Ä¢ From $259</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/polynesian-resort/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üå∫</span>
                            <div><div class="font-semibold">Polynesian Village</div><div class="text-xs text-gray-500">Deluxe ‚Ä¢ From $599</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/grand-floridian-resort-and-spa/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üëë</span>
                            <div><div class="font-semibold">Grand Floridian</div><div class="text-xs text-gray-500">Deluxe ‚Ä¢ From $649</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/animal-kingdom-lodge/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">ü¶Å</span>
                            <div><div class="font-semibold">Animal Kingdom Lodge</div><div class="text-xs text-gray-500">Deluxe ‚Ä¢ From $399</div></div>
                        </a>
                        <a href="https://disneyworld.disney.go.com/resorts/wilderness-lodge-resort/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 transition">
                            <span class="text-2xl">üå≤</span>
                            <div><div class="font-semibold">Wilderness Lodge</div><div class="text-xs text-gray-500">Deluxe ‚Ä¢ From $399</div></div>
                        </a>
                        <a href="https://www.marriott.com/en-us/hotels/mcowh-walt-disney-world-swan/overview/" target="_blank" class="flex items-center gap-3 p-3 border rounded-lg hover:bg-purple-50 transition">
                            <span class="text-2xl">ü¶¢</span>
                            <div><div class="font-semibold">Swan & Dolphin</div><div class="text-xs text-gray-500">Partner ‚Ä¢ Walk to Epcot!</div></div>
                        </a>
                    </div>
                </div>

                <!-- Pro Tips -->
                <div class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-2xl p-6 text-white">
                    <h2 class="text-xl font-bold mb-4">üíé Pro Strategies for Roy & Cindy</h2>
                    <div class="space-y-4">
                        <div class="flex gap-3">
                            <span class="text-2xl">1Ô∏è‚É£</span>
                            <div>
                                <h3 class="font-bold">The "Book & Watch" Strategy</h3>
                                <p class="text-purple-200 text-sm">Book a refundable rate now, keep checking Priceline/Hotwire. If you find a deal, book it and cancel the original.</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <span class="text-2xl">2Ô∏è‚É£</span>
                            <div>
                                <h3 class="font-bold">The Priceline Rebid Trick</h3>
                                <p class="text-purple-200 text-sm">Start with 5-star bids, then 4-star, then 3-star. Each star level counts as a separate bid - no 24-hour wait!</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <span class="text-2xl">3Ô∏è‚É£</span>
                            <div>
                                <h3 class="font-bold">Check at 4PM Orlando Time</h3>
                                <p class="text-purple-200 text-sm">This is when hotels release day-of inventory at steep discounts. Perfect for last-minute trips!</p>
                            </div>
                        </div>
                        <div class="flex gap-3">
                            <span class="text-2xl">4Ô∏è‚É£</span>
                            <div>
                                <h3 class="font-bold">15 Days Out = Sweet Spot</h3>
                                <p class="text-purple-200 text-sm">Studies show booking 15 days before arrival is 13% cheaper than 4 months out on average.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="deal-modal" class="modal-overlay fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4" onclick="closeModal(event)">
        <div class="modal-content bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()">
            <div class="relative p-6">
                <button onclick="closeModal()" class="absolute top-4 right-4 bg-gray-100 hover:bg-gray-200 rounded-full w-10 h-10 flex items-center justify-center">‚úï</button>
                <span id="modal-badge" class="inline-block px-4 py-1 rounded-full text-sm font-bold mb-4"></span>
                <h3 id="modal-title" class="text-2xl font-bold text-gray-900 mb-4 pr-8"></h3>
                <p id="modal-description" class="text-gray-600 mb-6"></p>
                <div class="bg-gray-50 rounded-xl p-4 space-y-3 mb-6">
                    <div class="flex items-center"><span class="w-8 text-xl">üè®</span><span id="modal-resort"></span></div>
                    <div class="flex items-center"><span class="w-8 text-xl">üìÖ</span><span id="modal-dates"></span></div>
                </div>
                <a id="modal-link" href="#" target="_blank" class="block w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white text-center py-4 rounded-xl font-bold text-lg">View on Disney.com ‚Üí</a>
            </div>
        </div>
    </div>

    <div id="add-deal-modal" class="modal-overlay fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4" onclick="closeAddDealModal(event)">
        <div class="modal-content bg-white rounded-2xl max-w-md w-full shadow-2xl" onclick="event.stopPropagation()">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4">üìù Log a Deal You Found</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hotel Name</label>
                        <input type="text" id="log-hotel" class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., Pop Century">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price Per Night</label>
                        <input type="text" id="log-price" class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., $89">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
                        <select id="log-source" class="w-full px-3 py-2 border rounded-lg">
                            <option>Priceline Express Deal</option>
                            <option>Hotwire Hot Rate</option>
                            <option>Disney Direct</option>
                            <option>Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Travel Dates</label>
                        <input type="text" id="log-dates" class="w-full px-3 py-2 border rounded-lg" placeholder="e.g., Dec 15-18">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes</label>
                        <textarea id="log-notes" class="w-full px-3 py-2 border rounded-lg" rows="2" placeholder="Any additional info..."></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="closeAddDealModal()" class="flex-1 py-2 text-gray-500 border rounded-lg">Cancel</button>
                    <button onclick="saveDealLog()" class="flex-1 py-2 bg-indigo-600 text-white rounded-lg font-bold">Save Deal</button>
                </div>
            </div>
        </div>
    </div>

    <div id="resort-modal" class="modal-overlay fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4" onclick="closeResortModal(event)">
        <div class="modal-content bg-white rounded-2xl max-w-md w-full shadow-2xl" onclick="event.stopPropagation()">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4">üè® Filter by Resort</h3>
                <div id="resort-picker-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
                <button onclick="closeResortModal()" class="w-full mt-4 py-2 text-gray-500">Cancel</button>
            </div>
        </div>
    </div>

    <div id="day-modal" class="modal-overlay fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4" onclick="closeDayModal(event)">
        <div class="modal-content bg-white rounded-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="day-modal-title" class="text-xl font-bold"></h3>
                    <button onclick="closeDayModal()" class="text-gray-400 hover:text-gray-600 text-2xl">‚úï</button>
                </div>
                <div id="day-modal-deals" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all z-50"></div>

    <footer class="bg-gray-800 text-gray-400 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p>Disney Deal Tracker ‚Ä¢ <span class="text-purple-400">Javari AI</span> ‚Ä¢ ¬© 2025 CR AudioViz AI, LLC</p>
            <p class="text-gray-500 text-sm mt-2">üîì Deal Hunter Pro - Private Access</p>
        </div>
    </footer>

    <script>
        const SUPABASE_URL = 'https://kteobfyferrukqeolofj.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt0ZW9iZnlmZXJydWtxZW9sb2ZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxOTcyNjYsImV4cCI6MjA3NzU1NzI2Nn0.uy-jlF_z6qVb8qogsNyGDLHqT4HhmdRhLrW7zPv3qhY';
        
        // Simple password - Roy can change this
        const SECRET_PASSWORD = 'disney2025';
        
        let allDeals = [], filteredDeals = [], currentFilter = 'all';
        let miniCalendarMonth = new Date(), currentMonth = new Date();
        let currentHotelFilter = 'all';
        let dealLogs = JSON.parse(localStorage.getItem('dealLogs') || '[]');

        const HOTELS = [
            { name: "Pop Century Resort", fullName: "Disney's Pop Century Resort", cat: 'disney', type: 'Value', price: 'From $169/night', rating: '4.2', url: 'https://disneyworld.disney.go.com/resorts/pop-century-resort/', features: ['Skyliner Access', 'Food Court', 'Pool'] },
            { name: "Art of Animation Resort", fullName: "Disney's Art of Animation Resort", cat: 'disney', type: 'Value', price: 'From $189/night', rating: '4.4', url: 'https://disneyworld.disney.go.com/resorts/art-of-animation-resort/', features: ['Skyliner Access', 'Family Suites', 'Themed Pools'] },
            { name: "All-Star Movies Resort", fullName: "Disney's All-Star Movies Resort", cat: 'disney', type: 'Value', price: 'From $149/night', rating: '4.0', url: 'https://disneyworld.disney.go.com/resorts/all-star-movies-resort/', features: ['Bus Transport', 'Food Court', '2 Pools'] },
            { name: "Caribbean Beach Resort", fullName: "Disney's Caribbean Beach Resort", cat: 'disney', type: 'Moderate', price: 'From $249/night', rating: '4.1', url: 'https://disneyworld.disney.go.com/resorts/caribbean-beach-resort/', features: ['Skyliner Access', 'Beach', 'Multiple Pools'] },
            { name: "Coronado Springs Resort", fullName: "Disney's Coronado Springs Resort", cat: 'disney', type: 'Moderate', price: 'From $259/night', rating: '4.2', url: 'https://disneyworld.disney.go.com/resorts/coronado-springs-resort/', features: ['Convention Center', 'Gran Destino Tower', 'Spa'] },
            { name: "Grand Floridian Resort", fullName: "Disney's Grand Floridian Resort & Spa", cat: 'disney', type: 'Deluxe', price: 'From $649/night', rating: '4.7', url: 'https://disneyworld.disney.go.com/resorts/grand-floridian-resort-and-spa/', features: ['Monorail', 'Walk to Magic Kingdom', 'Spa', 'Fine Dining'] },
            { name: "Polynesian Village Resort", fullName: "Disney's Polynesian Village Resort", cat: 'disney', type: 'Deluxe', price: 'From $599/night', rating: '4.6', url: 'https://disneyworld.disney.go.com/resorts/polynesian-resort/', features: ['Monorail', 'Beach', "Trader Sam's", 'Fireworks View'] },
            { name: "Contemporary Resort", fullName: "Disney's Contemporary Resort", cat: 'disney', type: 'Deluxe', price: 'From $499/night', rating: '4.5', url: 'https://disneyworld.disney.go.com/resorts/contemporary-resort/', features: ['Monorail', 'Walk to Magic Kingdom', 'Rooftop Restaurant'] },
            { name: "Animal Kingdom Lodge", fullName: "Disney's Animal Kingdom Lodge", cat: 'disney', type: 'Deluxe', price: 'From $399/night', rating: '4.8', url: 'https://disneyworld.disney.go.com/resorts/animal-kingdom-lodge/', features: ['Savanna Views', 'African Dining', 'Animals'] },
            { name: "Drury Plaza Hotel", fullName: "Drury Plaza Hotel Orlando", cat: 'partner', type: 'Partner', price: 'From $159/night', rating: '4.6', url: 'https://www.druryhotels.com/locations/orlando-fl/drury-plaza-hotel-orlando-disney-springs-area', features: ['Free Breakfast', 'Free Evening Reception', 'Pool'] },
            { name: "Hilton Buena Vista Palace", fullName: "Hilton Orlando Buena Vista Palace", cat: 'partner', type: 'Partner', price: 'From $189/night', rating: '4.4', url: 'https://www.hilton.com/en/hotels/mcoobhh-hilton-orlando-buena-vista-palace/', features: ['Disney Springs Walking', 'Spa', 'Multiple Restaurants'] },
            { name: "Wyndham Garden", fullName: "Wyndham Garden Lake Buena Vista", cat: 'partner', type: 'Partner', price: 'From $129/night', rating: '4.3', url: 'https://www.wyndhamhotels.com/wyndham-garden/lake-buena-vista-florida/wyndham-garden-lake-buena-vista-disney-springs-resort-area/overview', features: ['Near Disney Springs', 'Free Parking', 'Pool'] },
            { name: "DoubleTree Disney Springs", fullName: "DoubleTree Suites Disney Springs", cat: 'partner', type: 'Partner', price: 'From $179/night', rating: '4.3', url: 'https://www.hilton.com/en/hotels/mcoordt-doubletree-suites-by-hilton-orlando-disney-springs-area/', features: ['All Suites', 'Free Cookies', 'Disney Springs Walking'] },
            { name: "Comfort Suites Maingate", fullName: "Comfort Suites Maingate East", cat: 'budget', type: 'Budget', price: 'From $89/night', rating: '4.0', url: 'https://www.choicehotels.com/florida/kissimmee/comfort-suites-hotels/fl478', features: ['Free Breakfast', 'Pool', 'Near Disney'] },
            { name: "Best Western Lake Buena Vista", fullName: "Best Western Lake Buena Vista", cat: 'budget', type: 'Budget', price: 'From $99/night', rating: '3.9', url: 'https://www.bestwestern.com/en_US/book/hotels-in-orlando/best-western-lake-buena-vista-disney-springs-resort-area/propertyCode.10192.html', features: ['Free Shuttle', 'Pool', 'Near Disney Springs'] },
            { name: "La Quinta Orlando", fullName: "La Quinta Inn & Suites Orlando", cat: 'budget', type: 'Budget', price: 'From $79/night', rating: '4.1', url: 'https://www.wyndhamhotels.com/laquinta/kissimmee-florida/la-quinta-inn-and-suites-kissimmee-lake-buena-vista-south/overview', features: ['Free Breakfast', 'Pet Friendly', 'Pool'] },
            { name: "Holiday Inn Disney Springs", fullName: "Holiday Inn Disney Springs", cat: 'budget', type: 'Budget', price: 'From $119/night', rating: '4.2', url: 'https://www.ihg.com/holidayinn/hotels/us/en/lake-buena-vista/mcods/hoteldetail', features: ['Near Disney Springs', 'Pool', 'Restaurant'] }
        ];

        document.addEventListener('DOMContentLoaded', () => { 
            loadDeals(); 
            renderHotels(); 
            updateMagicHourCountdown();
            setInterval(updateMagicHourCountdown, 1000);
            renderDealLogs();
        });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeModal(); closeDayModal(); closeResortModal(); closeAddDealModal(); } });

        // Magic Hour Countdown (4PM Orlando/EST)
        function updateMagicHourCountdown() {
            const now = new Date();
            const orlando = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
            let target = new Date(orlando);
            target.setHours(16, 0, 0, 0); // 4PM
            
            if (orlando >= target) {
                target.setDate(target.getDate() + 1);
            }
            
            const diff = target - orlando;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('magic-hour-countdown').textContent = 
                `${hours.toString().padStart(2,'0')}:${mins.toString().padStart(2,'0')}:${secs.toString().padStart(2,'0')}`;
        }

        // Secrets Tab Password Protection
        function showSecretsTab() {
            showTab('secrets');
            if (sessionStorage.getItem('secretsUnlocked') === 'true') {
                document.getElementById('secrets-gate').classList.add('hidden');
                document.getElementById('secrets-content').classList.remove('hidden');
            }
        }

        function unlockSecrets() {
            const password = document.getElementById('secrets-password').value;
            if (password === SECRET_PASSWORD) {
                sessionStorage.setItem('secretsUnlocked', 'true');
                document.getElementById('secrets-gate').classList.add('hidden');
                document.getElementById('secrets-content').classList.remove('hidden');
                document.getElementById('password-error').classList.add('hidden');
                showToast('üîì Deal Hunter Pro unlocked!');
            } else {
                document.getElementById('password-error').classList.remove('hidden');
            }
        }

        // Deal Log functions
        function addDealLog() {
            document.getElementById('add-deal-modal').classList.add('active');
        }

        function closeAddDealModal(e) {
            if (!e || e.target === e.currentTarget) document.getElementById('add-deal-modal').classList.remove('active');
        }

        function saveDealLog() {
            const log = {
                id: Date.now(),
                hotel: document.getElementById('log-hotel').value,
                price: document.getElementById('log-price').value,
                source: document.getElementById('log-source').value,
                dates: document.getElementById('log-dates').value,
                notes: document.getElementById('log-notes').value,
                timestamp: new Date().toLocaleString()
            };
            dealLogs.unshift(log);
            localStorage.setItem('dealLogs', JSON.stringify(dealLogs));
            renderDealLogs();
            closeAddDealModal();
            showToast('‚úÖ Deal logged!');
            // Clear form
            document.getElementById('log-hotel').value = '';
            document.getElementById('log-price').value = '';
            document.getElementById('log-dates').value = '';
            document.getElementById('log-notes').value = '';
        }

        function deleteDealLog(id) {
            dealLogs = dealLogs.filter(l => l.id !== id);
            localStorage.setItem('dealLogs', JSON.stringify(dealLogs));
            renderDealLogs();
            showToast('Deleted');
        }

        function renderDealLogs() {
            const container = document.getElementById('deal-log-container');
            if (dealLogs.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">No deals logged yet. Click "Add Deal" when you find one!</p>';
                return;
            }
            container.innerHTML = dealLogs.map(log => `
                <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="font-bold text-gray-900">${esc(log.hotel)}</span>
                            <span class="text-green-600 font-bold">${esc(log.price)}</span>
                        </div>
                        <div class="text-sm text-gray-500">${esc(log.source)} ‚Ä¢ ${esc(log.dates)}</div>
                        ${log.notes ? `<div class="text-sm text-gray-400 mt-1">${esc(log.notes)}</div>` : ''}
                        <div class="text-xs text-gray-300 mt-1">${log.timestamp}</div>
                    </div>
                    <button onclick="deleteDealLog(${log.id})" class="text-red-400 hover:text-red-600 text-xl">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        async function loadDeals() {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/deals?select=*,resorts(name)&is_active=eq.true&order=discount_percentage.desc.nullslast`, 
                    { headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` } });
                const data = await response.json();
                if (Array.isArray(data)) {
                    allDeals = data; filteredDeals = data;
                    updateStats(); renderDeals(filteredDeals); renderFilters(); renderResortStats(); renderCalendar(); renderFullCalendar();
                }
            } catch (e) { console.error(e); }
        }

        function updateStats() {
            document.getElementById('total-deals').textContent = allDeals.length;
            const discounts = allDeals.map(d => d.discount_percentage).filter(d => d);
            document.getElementById('best-discount').textContent = discounts.length ? Math.max(...discounts) + '%' : '-';
            document.getElementById('resorts-count').textContent = new Set(allDeals.map(d => d.resorts?.name).filter(n => n)).size || 4;
        }

        function renderDeals(deals) {
            document.getElementById('showing-count').textContent = `${deals.length} deals`;
            if (!deals.length) { document.getElementById('deals-container').innerHTML = '<div class="p-8 text-center text-gray-500">No deals found.</div>'; return; }
            document.getElementById('deals-container').innerHTML = deals.map((d) => `
                <div class="deal-card p-6 clickable" onclick="showDealModal(${allDeals.indexOf(d)})">
                    <div class="flex justify-between items-start gap-4">
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-900 text-lg mb-2">${esc(d.title)}</h3>
                            <p class="text-gray-600 text-sm mb-3">${esc(d.description||'').substring(0,150)}...</p>
                            <div class="flex gap-4 text-sm">
                                <span class="text-gray-500">üè® ${esc(d.resorts?.name||'Disney')}</span>
                                <span class="text-gray-400">üìÖ Until ${fmtDate(d.valid_to)}</span>
                            </div>
                        </div>
                        ${d.discount_percentage ? `<div class="bg-green-500 text-white px-4 py-2 rounded-xl text-center"><div class="text-2xl font-bold">${d.discount_percentage}%</div><div class="text-xs">OFF</div></div>` : `<div class="bg-blue-500 text-white px-4 py-2 rounded-xl"><div class="text-lg font-bold">Special</div></div>`}
                    </div>
                </div>
            `).join('');
        }

        function renderFilters() {
            const resorts = [...new Set(allDeals.map(d => d.resorts?.name).filter(n => n))];
            document.getElementById('filter-buttons').innerHTML = `<button onclick="filterDeals('all')" class="filter-btn ${currentFilter==='all'?'active':''} px-4 py-2 rounded-full text-sm font-medium border transition">All</button>` + resorts.map(r => `<button onclick="filterDeals('${esc(r)}')" class="filter-btn ${currentFilter===r?'active':''} px-4 py-2 rounded-full text-sm font-medium border transition">${esc(r.replace("Disney's ",''))}</button>`).join('');
        }

        function renderResortStats() {
            const counts = {}; allDeals.forEach(d => { const n = d.resorts?.name||'Unknown'; counts[n] = (counts[n]||0)+1; });
            document.getElementById('resort-stats').innerHTML = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,5).map(([r,c]) => `<div class="p-4 flex justify-between items-center hover:bg-gray-50 cursor-pointer" onclick="filterDeals('${esc(r)}')"><span class="text-gray-700">${esc(r.replace("Disney's ",''))}</span><span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm">${c}</span></div>`).join('');
        }

        function filterDeals(f) { currentFilter=f; filteredDeals = f==='all' ? allDeals : allDeals.filter(d=>d.resorts?.name===f); renderDeals(filteredDeals); renderFilters(); }

        function filterHotels(cat) {
            currentHotelFilter = cat;
            document.querySelectorAll('.hotel-filter').forEach(b => { b.classList.remove('bg-blue-500','text-white'); b.classList.add('bg-gray-200','text-gray-700'); });
            document.querySelector(`[data-cat="${cat}"]`).classList.remove('bg-gray-200','text-gray-700');
            document.querySelector(`[data-cat="${cat}"]`).classList.add('bg-blue-500','text-white');
            renderHotels();
        }

        function renderHotels() {
            const filtered = currentHotelFilter === 'all' ? HOTELS : HOTELS.filter(h => h.cat === currentHotelFilter);
            document.getElementById('hotels-container').innerHTML = filtered.map(h => `
                <div class="hotel-card bg-white border rounded-xl p-5 transition">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="font-bold text-lg text-gray-900">${h.name}</h3>
                                <span class="text-xs px-2 py-0.5 rounded ${h.cat==='disney'?'bg-blue-100 text-blue-700':h.cat==='partner'?'bg-purple-100 text-purple-700':'bg-gray-100 text-gray-600'}">${h.type}</span>
                            </div>
                            <div class="flex items-center gap-3 text-sm mb-3">
                                <span class="text-yellow-500">‚òÖ ${h.rating}</span>
                                <span class="text-green-600 font-semibold">${h.price}</span>
                            </div>
                            <div class="flex flex-wrap gap-1">
                                ${h.features.map(f => `<span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">${f}</span>`).join('')}
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 md:w-48">
                            <a href="${h.url}" target="_blank" rel="noopener" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-center transition text-sm">
                                Check Availability ‚Üí
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderCalendar() {
            const y = miniCalendarMonth.getFullYear(), m = miniCalendarMonth.getMonth();
            document.getElementById('calendar-month').textContent = miniCalendarMonth.toLocaleDateString('en-US',{month:'short',year:'numeric'});
            const firstDay = new Date(y,m,1).getDay(), days = new Date(y,m+1,0).getDate();
            const today = new Date();
            const dealsByDay = {}; allDeals.forEach(deal => { const s=new Date(deal.valid_from), e=new Date(deal.valid_to); for(let d=1;d<=days;d++){const dt=new Date(y,m,d);if(dt>=s&&dt<=e){dealsByDay[d]=true;}} });
            let html = ''; for(let i=0;i<firstDay;i++)html+='<div class="p-2"></div>';
            for(let d=1;d<=days;d++){const has=dealsByDay[d], isToday=d===today.getDate()&&m===today.getMonth()&&y===today.getFullYear(); html+=`<div class="calendar-day p-2 text-center rounded text-sm ${has?'has-deals':'text-gray-400'} ${isToday?'ring-2 ring-blue-500':''}" ${has?`onclick="showDayDeals(${d},${y},${m})"`:''}>${d}</div>`;}
            document.getElementById('calendar-grid').innerHTML = html;
        }
        function changeMiniMonth(d) { miniCalendarMonth = new Date(miniCalendarMonth.getFullYear(), miniCalendarMonth.getMonth()+d, 1); renderCalendar(); }

        function renderFullCalendar() {
            const y=currentMonth.getFullYear(), m=currentMonth.getMonth();
            document.getElementById('full-calendar-month').textContent = currentMonth.toLocaleDateString('en-US',{month:'long',year:'numeric'});
            const firstDay = new Date(y,m,1).getDay(), days = new Date(y,m+1,0).getDate();
            const today = new Date();
            const dealsByDay = {}; allDeals.forEach(deal => { const s=new Date(deal.valid_from), e=new Date(deal.valid_to); for(let d=1;d<=days;d++){const dt=new Date(y,m,d);if(dt>=s&&dt<=e){if(!dealsByDay[d])dealsByDay[d]=[];dealsByDay[d].push(deal);}} });
            let html = ''; for(let i=0;i<firstDay;i++)html+='<div class="p-4 bg-gray-50 rounded"></div>';
            for(let d=1;d<=days;d++){const deals=dealsByDay[d]||[], best=deals.reduce((m,x)=>Math.max(m,x.discount_percentage||0),0), isToday=d===today.getDate()&&m===today.getMonth()&&y===today.getFullYear();
            html+=`<div class="p-3 border rounded-lg min-h-[80px] ${deals.length?'bg-green-50 cursor-pointer hover:bg-green-100':'bg-white'} ${isToday?'ring-2 ring-blue-500':''}" ${deals.length?`onclick="showDayDeals(${d},${y},${m})"`:''}><div class="font-bold ${deals.length?'text-green-700':'text-gray-600'}">${d}</div>${deals.length?`<div class="text-xs text-green-600">${deals.length} deal${deals.length>1?'s':''}</div>${best?`<div class="text-xs font-bold text-green-700">${best}% off</div>`:''}`:''}}</div>`;}
            document.getElementById('full-calendar-grid').innerHTML = html;
        }
        function changeMonth(d) { currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()+d, 1); renderFullCalendar(); }
        function goToTodayFull() { currentMonth = new Date(); renderFullCalendar(); }

        function showTab(t) { 
            document.querySelectorAll('.tab-content').forEach(x=>x.classList.add('hidden')); 
            document.querySelectorAll('.tab-btn').forEach(x=>x.classList.remove('active')); 
            document.getElementById(t+'-tab').classList.remove('hidden'); 
            const btn = document.querySelector(`[data-tab="${t}"]`);
            if(btn) btn.classList.add('active'); 
            if(t==='calendar')renderFullCalendar(); 
        }

        function showDealModal(i) { const d=allDeals[i]; if(!d)return; document.getElementById('modal-title').textContent=d.title; document.getElementById('modal-description').textContent=d.description||''; document.getElementById('modal-resort').textContent=d.resorts?.name||'Disney Resort'; document.getElementById('modal-dates').textContent=`${fmtDate(d.valid_from)} - ${fmtDate(d.valid_to)}`; document.getElementById('modal-link').href=d.source_url||'https://disneyworld.disney.go.com/special-offers/'; const b=document.getElementById('modal-badge'); b.textContent=d.discount_percentage?`${d.discount_percentage}% OFF`:'Special'; b.className=`inline-block px-4 py-1 rounded-full text-sm font-bold ${d.discount_percentage?'bg-green-100 text-green-800':'bg-blue-100 text-blue-800'}`; document.getElementById('deal-modal').classList.add('active'); }
        function closeModal(e) { if(!e||e.target===e.currentTarget)document.getElementById('deal-modal').classList.remove('active'); }
        function showDayDeals(d,y,m) { const dt=new Date(y,m,d); const dayDeals=allDeals.filter(x=>{const s=new Date(x.valid_from),e=new Date(x.valid_to);return dt>=s&&dt<=e;}); document.getElementById('day-modal-title').textContent=`${dt.toLocaleDateString('en-US',{month:'long',day:'numeric'})}`; document.getElementById('day-modal-deals').innerHTML=dayDeals.map(x=>`<div class="p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100" onclick="closeDayModal();showDealModal(${allDeals.indexOf(x)});"><div class="flex justify-between"><div><h4 class="font-semibold">${esc(x.title)}</h4></div>${x.discount_percentage?`<span class="bg-green-500 text-white px-2 py-1 rounded text-sm">${x.discount_percentage}%</span>`:''}</div></div>`).join(''); document.getElementById('day-modal').classList.add('active'); }
        function closeDayModal(e) { if(!e||e.target===e.currentTarget)document.getElementById('day-modal').classList.remove('active'); }
        function showResortPicker() { const resorts=[...new Set(allDeals.map(d=>d.resorts?.name).filter(n=>n))]; document.getElementById('resort-picker-list').innerHTML=`<button onclick="filterDeals('all');closeResortModal();" class="w-full text-left p-3 rounded-lg hover:bg-gray-100 font-medium">All Resorts</button>`+resorts.map(r=>`<button onclick="filterDeals('${esc(r)}');closeResortModal();" class="w-full text-left p-3 rounded-lg hover:bg-gray-100">${esc(r)}</button>`).join(''); document.getElementById('resort-modal').classList.add('active'); }
        function closeResortModal(e) { if(!e||e.target===e.currentTarget)document.getElementById('resort-modal').classList.remove('active'); }
        function showBestDeal() { const best=allDeals.reduce((b,d)=>(!b||(d.discount_percentage||0)>(b.discount_percentage||0))?d:b,null); if(best)showDealModal(allDeals.indexOf(best)); }
        async function refreshDeals() { document.getElementById('refresh-icon').classList.add('animate-spin'); await loadDeals(); setTimeout(()=>document.getElementById('refresh-icon').classList.remove('animate-spin'),1000); showToast('Refreshed!'); }
        function showToast(m) { const t=document.getElementById('toast');t.textContent=m;t.classList.remove('translate-y-20','opacity-0');setTimeout(()=>t.classList.add('translate-y-20','opacity-0'),2500); }
        function esc(t) { return t?t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'):''; }
        function fmtDate(d) { return d?new Date(d).toLocaleDateString('en-US',{month:'short',day:'numeric'}):'TBD'; }
    </script>
</body>
</html>
