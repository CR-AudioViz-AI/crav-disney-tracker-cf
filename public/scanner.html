<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Deal Scanner - Passholder & Regular Deals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
    <style>
        .scanner-gradient { background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #4c1d95 100%); }
        .passholder-gradient { background: linear-gradient(135deg, #065f46 0%, #047857 50%, #10b981 100%); }
        .glow { box-shadow: 0 0 30px rgba(168,85,247,0.4); }
        .glow-green { box-shadow: 0 0 20px rgba(34,197,94,0.5); }
        .glow-gold { box-shadow: 0 0 20px rgba(234,179,8,0.5); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.6;} }
        .hotel-row:hover { background: linear-gradient(90deg, #f0fdf4 0%, #ecfdf5 100%); transform: translateX(4px); }
        .scanner-btn { transition: all 0.2s; }
        .scanner-btn:hover { transform: scale(1.02); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
        .live-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 1.5s infinite; }
        .tab-active { background: white; color: #7c3aed; border-bottom: 3px solid #7c3aed; }
        .filter-active { background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%); color: white; }
        .area-chip.selected { background: #7c3aed; color: white; border-color: #7c3aed; }
        .type-chip.selected { background: #059669; color: white; border-color: #059669; }
        @keyframes slideIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .animate-in { animation: slideIn 0.3s ease-out; }
        .passholder-toggle { transition: all 0.3s; }
        .passholder-badge { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header id="main-header" class="scanner-gradient text-white shadow-2xl">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4">
                <div>
                    <div class="flex items-center gap-3">
                        <span class="text-4xl">üîç</span>
                        <div>
                            <h1 class="text-3xl font-bold">Disney Deal Scanner</h1>
                            <p id="header-subtitle" class="text-purple-200">Find secret hotel deals before anyone else</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <!-- PASSHOLDER TOGGLE -->
                    <button onclick="togglePassholderMode()" id="passholder-toggle" class="passholder-toggle flex items-center gap-2 bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg border-2 border-white/30">
                        <span class="text-xl">üéüÔ∏è</span>
                        <span id="passholder-label" class="font-medium">Passholder Mode</span>
                        <div id="passholder-indicator" class="w-12 h-6 bg-gray-600 rounded-full relative transition-all">
                            <div id="passholder-dot" class="absolute left-1 top-1 w-4 h-4 bg-white rounded-full transition-all"></div>
                        </div>
                    </button>
                    <div class="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-lg">
                        <div class="live-dot"></div>
                        <span class="text-sm">Live Pricing</span>
                    </div>
                    <div id="magic-hour-display" class="text-center bg-gradient-to-r from-amber-500 to-orange-500 px-4 py-2 rounded-lg">
                        <div class="text-xs text-amber-100">Magic Hour in</div>
                        <div id="countdown" class="font-mono font-bold">--:--:--</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- PASSHOLDER INFO BANNER (hidden by default) -->
    <div id="passholder-banner" class="hidden bg-gradient-to-r from-yellow-400 via-amber-400 to-yellow-500 text-gray-900 py-4">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <span class="text-3xl">üéüÔ∏è</span>
                    <div>
                        <h2 class="font-bold text-lg">Annual Passholder Mode Active</h2>
                        <p class="text-sm text-gray-700">Showing room-only deals ‚Ä¢ No ticket packages ‚Ä¢ Up to 35% AP discounts</p>
                    </div>
                </div>
                <a href="https://disneyworld.disney.go.com/passholder-program/experiences-perks-offers/" target="_blank" 
                   class="bg-gray-900 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-800 transition">
                    View Official AP Deals ‚Üí
                </a>
            </div>
        </div>
    </div>

    <!-- Main Scanner Interface -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Date & Guest Selector -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 glow">
            <div class="flex items-center gap-2 mb-4">
                <span class="text-2xl">üìÖ</span>
                <h2 class="text-xl font-bold text-gray-800">Step 1: Select Your Dates</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Check-in Date</label>
                    <input type="date" id="checkin-date" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Check-out Date</label>
                    <input type="date" id="checkout-date" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Guests</label>
                    <select id="guests" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg">
                        <option value="2">2 Adults</option>
                        <option value="3">3 Adults</option>
                        <option value="4">4 Adults</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Rooms</label>
                    <select id="rooms" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none text-lg">
                        <option value="1">1 Room</option>
                        <option value="2">2 Rooms</option>
                    </select>
                </div>
            </div>
            <div id="date-tip" class="mt-4 flex items-center gap-2 text-sm text-gray-500">
                <span>üí°</span>
                <span>Tip: Check 15 days before arrival for best deals. Book on Tuesdays for 16% savings!</span>
            </div>
        </div>

        <!-- Area & Type Filters -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-6">
            <div class="flex items-center gap-2 mb-4">
                <span class="text-2xl">üéØ</span>
                <h2 class="text-xl font-bold text-gray-800">Step 2: Filter Hotels</h2>
            </div>
            
            <!-- Area Selection -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-600 mb-2">üìç Area</label>
                <div class="flex flex-wrap gap-2" id="area-filters">
                    <button onclick="toggleArea('all')" class="area-chip selected px-4 py-2 border-2 rounded-full text-sm font-medium transition" data-area="all">üåê All Areas</button>
                    <button onclick="toggleArea('bonnet-creek')" class="area-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-area="bonnet-creek">üè∞ Disney Resorts (Bonnet Creek)</button>
                    <button onclick="toggleArea('disney-springs')" class="area-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-area="disney-springs">üõçÔ∏è Disney Springs</button>
                    <button onclick="toggleArea('universal')" class="area-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-area="universal">üé¢ Universal Area</button>
                    <button onclick="toggleArea('lbv')" class="area-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-area="lbv">üå¥ Lake Buena Vista</button>
                </div>
            </div>
            
            <!-- Type Selection -->
            <div>
                <label class="block text-sm font-medium text-gray-600 mb-2">üè® Hotel Type</label>
                <div class="flex flex-wrap gap-2" id="type-filters">
                    <button onclick="toggleType('all')" class="type-chip selected px-4 py-2 border-2 rounded-full text-sm font-medium transition" data-type="all">‚ú® All Types</button>
                    <button onclick="toggleType('deluxe')" class="type-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-type="deluxe">üëë Disney Deluxe</button>
                    <button onclick="toggleType('moderate')" class="type-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-type="moderate">‚≠ê Disney Moderate</button>
                    <button onclick="toggleType('value')" class="type-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-type="value">üí∞ Disney Value</button>
                    <button onclick="toggleType('partner')" class="type-chip px-4 py-2 border-2 border-gray-300 rounded-full text-sm font-medium transition" data-type="partner">ü§ù Partner/Off-site</button>
                </div>
            </div>
        </div>

        <!-- SCAN BUTTONS -->
        <div id="scan-section" class="bg-gradient-to-r from-purple-600 via-violet-600 to-indigo-600 rounded-2xl shadow-xl p-6 mb-6 text-white">
            <div class="flex items-center gap-2 mb-4">
                <span class="text-2xl pulse">üöÄ</span>
                <h2 class="text-xl font-bold">Step 3: Scan for Deals</h2>
                <span class="bg-white/20 px-3 py-1 rounded-full text-sm ml-auto">Opens in new tabs</span>
            </div>
            <div id="scan-buttons" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <button onclick="scanRoomRevealer()" class="scanner-btn bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                    <span class="text-2xl">üîÆ</span>
                    <div class="text-left">
                        <div>RoomRevealer</div>
                        <div class="text-xs font-normal opacity-80">See revealed hotels + prices</div>
                    </div>
                </button>
                <button onclick="scanPriceline()" class="scanner-btn bg-gradient-to-r from-blue-500 to-indigo-500 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                    <span class="text-2xl">üéØ</span>
                    <div class="text-left">
                        <div>Priceline Express</div>
                        <div class="text-xs font-normal opacity-80">Mystery deals up to 60% off</div>
                    </div>
                </button>
                <button onclick="scanHotwire()" class="scanner-btn bg-gradient-to-r from-orange-500 to-red-500 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                    <span class="text-2xl">üî•</span>
                    <div class="text-left">
                        <div>Hotwire Hot Rate</div>
                        <div class="text-xs font-normal opacity-80">Hidden hotel deals</div>
                    </div>
                </button>
                <button onclick="scanAll()" class="scanner-btn bg-gradient-to-r from-yellow-400 to-amber-500 text-gray-900 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 glow-green">
                    <span class="text-2xl">‚ö°</span>
                    <div class="text-left">
                        <div>SCAN ALL</div>
                        <div class="text-xs font-normal opacity-80">Open all 3 sites at once!</div>
                    </div>
                </button>
            </div>
            <!-- Passholder-specific buttons (hidden by default) -->
            <div id="ap-scan-buttons" class="hidden mt-4 pt-4 border-t border-white/20">
                <div class="flex items-center gap-2 mb-3">
                    <span class="text-xl">üéüÔ∏è</span>
                    <span class="font-bold">Annual Passholder Direct Booking</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <a href="https://disneyworld.disney.go.com/passholder-program/experiences-perks-offers/" target="_blank"
                       class="scanner-btn bg-gradient-to-r from-yellow-400 to-amber-500 text-gray-900 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 glow-gold">
                        <span class="text-2xl">üéüÔ∏è</span>
                        <div class="text-left">
                            <div>Disney AP Discounts</div>
                            <div class="text-xs font-normal opacity-80">Up to 35% off room-only!</div>
                        </div>
                    </a>
                    <a href="https://disneyworld.disney.go.com/resorts/" target="_blank"
                       class="scanner-btn bg-gradient-to-r from-pink-500 to-rose-500 px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                        <span class="text-2xl">üè∞</span>
                        <div class="text-left">
                            <div>Book Disney Direct</div>
                            <div class="text-xs font-normal opacity-80">Room-only rates (call for AP)</div>
                        </div>
                    </a>
                </div>
            </div>
            <div id="scan-tip" class="mt-4 bg-white/10 rounded-lg p-3 text-sm">
                <strong>üéØ Pro Tip:</strong> After scanning, look for hotels matching the identifiers below. Use RoomRevealer to see which mystery hotel is which!
            </div>
        </div>

        <!-- PASSHOLDER DISCOUNT TABLE (hidden by default) -->
        <div id="ap-discounts-section" class="hidden bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-300 rounded-2xl p-6 mb-6">
            <h3 class="text-xl font-bold text-yellow-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">üéüÔ∏è</span> Current Annual Passholder Room-Only Discounts
            </h3>
            <div class="text-sm text-yellow-700 mb-4">
                <strong>Valid Dates:</strong> Most Sunday-Thursday Oct 12 - Nov 20, 2025 & Nov 23 - Dec 25, 2025 | <strong>Early 2026:</strong> Jan 4 - Apr 30, 2026
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- 30-35% Tier -->
                <div class="bg-white rounded-xl p-4 shadow-sm border-2 border-green-200">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-2xl">üëë</span>
                        <span class="text-2xl font-bold text-green-600">30-35% OFF</span>
                    </div>
                    <p class="text-xs text-gray-500 mb-2">Deluxe Resorts</p>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Grand Floridian</li>
                        <li>‚Ä¢ Polynesian Village</li>
                        <li>‚Ä¢ Contemporary</li>
                        <li>‚Ä¢ Beach Club</li>
                        <li>‚Ä¢ Yacht Club</li>
                        <li>‚Ä¢ BoardWalk Inn</li>
                        <li>‚Ä¢ Wilderness Lodge</li>
                        <li>‚Ä¢ Animal Kingdom Lodge</li>
                        <li>‚Ä¢ Riviera</li>
                    </ul>
                </div>
                <!-- 25-30% Tier -->
                <div class="bg-white rounded-xl p-4 shadow-sm border-2 border-blue-200">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-2xl">‚≠ê</span>
                        <span class="text-2xl font-bold text-blue-600">25-30% OFF</span>
                    </div>
                    <p class="text-xs text-gray-500 mb-2">Moderate Resorts + Some DVC</p>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Coronado Springs</li>
                        <li>‚Ä¢ Caribbean Beach</li>
                        <li>‚Ä¢ Port Orleans Riverside</li>
                        <li>‚Ä¢ Port Orleans French Qtr</li>
                        <li>‚Ä¢ Boulder Ridge Villas</li>
                        <li>‚Ä¢ Copper Creek Villas</li>
                    </ul>
                </div>
                <!-- 20-25% Tier -->
                <div class="bg-white rounded-xl p-4 shadow-sm border-2 border-purple-200">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-2xl">üí∞</span>
                        <span class="text-2xl font-bold text-purple-600">20-25% OFF</span>
                    </div>
                    <p class="text-xs text-gray-500 mb-2">Value Resorts</p>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li>‚Ä¢ Pop Century</li>
                        <li>‚Ä¢ Art of Animation</li>
                        <li>‚Ä¢ All-Star Movies</li>
                        <li>‚Ä¢ All-Star Music</li>
                        <li>‚Ä¢ All-Star Sports</li>
                        <li>‚Ä¢ Fort Wilderness Cabins</li>
                    </ul>
                </div>
            </div>
            <div class="mt-4 bg-yellow-100 rounded-lg p-3 text-sm text-yellow-800">
                <strong>‚ö†Ô∏è Important:</strong> AP discount is room-only. Call Disney at <strong>407-939-7675</strong> or book online and mention your AP at check-in. Cannot combine with other offers. Must show valid AP.
            </div>
        </div>

        <!-- Hotel Database with Identifiers -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden mb-6">
            <div class="bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4 text-white">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">üè®</span>
                        <div>
                            <h2 class="text-xl font-bold">Hotel Identification Guide</h2>
                            <p id="hotel-subtitle" class="text-gray-300 text-sm">Match mystery hotels to real hotels using these clues</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div id="hotel-count" class="text-2xl font-bold">0</div>
                        <div class="text-xs text-gray-400">hotels shown</div>
                    </div>
                </div>
            </div>
            
            <!-- Table Header -->
            <div class="bg-gray-100 px-6 py-3 border-b grid grid-cols-12 gap-2 text-sm font-bold text-gray-600">
                <div class="col-span-3">Hotel</div>
                <div class="col-span-2">Priceline ID</div>
                <div class="col-span-2">Location</div>
                <div id="discount-header" class="col-span-2">Key Clues</div>
                <div class="col-span-1">Price</div>
                <div class="col-span-2 text-right">Action</div>
            </div>
            
            <!-- Hotel Rows -->
            <div id="hotel-list" class="divide-y max-h-[600px] overflow-y-auto">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Quick Identification Tips -->
        <div id="id-tips" class="bg-gradient-to-r from-yellow-50 to-amber-50 border-2 border-yellow-200 rounded-2xl p-6 mb-6">
            <h3 class="text-lg font-bold text-yellow-800 mb-4 flex items-center gap-2">
                <span class="text-2xl">üí°</span> Quick Identification Cheat Sheet
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white rounded-xl p-4 shadow-sm">
                    <div class="text-2xl mb-2">üëë</div>
                    <h4 class="font-bold text-gray-800">Disney Deluxe</h4>
                    <ul class="text-sm text-gray-600 mt-2 space-y-1">
                        <li>‚Ä¢ 4‚≠ê on Priceline</li>
                        <li>‚Ä¢ "Bonnet Creek" area</li>
                        <li>‚Ä¢ <strong>NO resort fee!</strong></li>
                        <li>‚Ä¢ Airport shuttle</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-sm">
                    <div class="text-2xl mb-2">‚≠ê</div>
                    <h4 class="font-bold text-gray-800">Disney Moderate</h4>
                    <ul class="text-sm text-gray-600 mt-2 space-y-1">
                        <li>‚Ä¢ 3.5‚≠ê on Priceline</li>
                        <li>‚Ä¢ "Bonnet Creek" area</li>
                        <li>‚Ä¢ <strong>NO resort fee!</strong></li>
                        <li>‚Ä¢ Airport shuttle</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-sm">
                    <div class="text-2xl mb-2">üí∞</div>
                    <h4 class="font-bold text-gray-800">Disney Value</h4>
                    <ul class="text-sm text-gray-600 mt-2 space-y-1">
                        <li>‚Ä¢ 3‚≠ê on Priceline</li>
                        <li>‚Ä¢ "Bonnet Creek" area</li>
                        <li>‚Ä¢ <strong>NO resort fee!</strong></li>
                        <li>‚Ä¢ Free parking</li>
                    </ul>
                </div>
                <div class="bg-white rounded-xl p-4 shadow-sm">
                    <div class="text-2xl mb-2">ü¶¢</div>
                    <h4 class="font-bold text-gray-800">Swan/Dolphin</h4>
                    <ul class="text-sm text-gray-600 mt-2 space-y-1">
                        <li>‚Ä¢ 4‚≠ê on Priceline</li>
                        <li>‚Ä¢ "Bonnet Creek" area</li>
                        <li>‚Ä¢ <strong>HAS $35 resort fee</strong></li>
                        <li>‚Ä¢ Walk to Epcot!</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Your Deal Log -->
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="bg-gradient-to-r from-slate-700 to-slate-800 px-6 py-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">üìù</span>
                    <div>
                        <h2 class="text-lg font-bold">Your Deal Log</h2>
                        <p class="text-slate-300 text-sm">Track deals you find for comparison</p>
                    </div>
                </div>
                <button onclick="showAddDealModal()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition font-medium">+ Add Deal</button>
            </div>
            <div class="p-6">
                <div id="deal-log" class="space-y-3">
                    <p class="text-gray-400 text-center py-8">No deals logged yet. Find a deal and click "Add Deal" to track it!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Deal Modal -->
    <div id="add-deal-modal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50 hidden" onclick="hideAddDealModal(event)">
        <div class="bg-white rounded-2xl max-w-md w-full mx-4 shadow-2xl" onclick="event.stopPropagation()">
            <div class="p-6">
                <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                    <span>üìù</span> Log a Deal You Found
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Hotel Name</label>
                        <input type="text" id="deal-hotel" class="w-full px-4 py-2 border rounded-lg" placeholder="e.g., Pop Century (or Mystery 3‚≠ê Bonnet Creek)">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Price/Night</label>
                            <input type="text" id="deal-price" class="w-full px-4 py-2 border rounded-lg" placeholder="$149">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Source</label>
                            <select id="deal-source" class="w-full px-4 py-2 border rounded-lg">
                                <option>Priceline Express</option>
                                <option>Hotwire Hot Rate</option>
                                <option>RoomRevealer</option>
                                <option>Disney AP Discount</option>
                                <option>Disney Direct</option>
                                <option>Other</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Travel Dates</label>
                        <input type="text" id="deal-dates" class="w-full px-4 py-2 border rounded-lg" placeholder="Dec 15-18">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes / Clues</label>
                        <textarea id="deal-notes" class="w-full px-4 py-2 border rounded-lg" rows="2" placeholder="e.g., 3‚≠ê, Bonnet Creek, no resort fee, airport shuttle"></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button onclick="hideAddDealModal()" class="flex-1 py-3 border rounded-xl font-medium text-gray-600">Cancel</button>
                    <button onclick="saveDeal()" class="flex-1 py-3 bg-purple-600 text-white rounded-xl font-bold">Save Deal</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all z-50"></div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-gray-400 py-8 mt-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p>Disney Deal Scanner ‚Ä¢ <span class="text-purple-400">Javari AI</span> ‚Ä¢ ¬© 2025 CR AudioViz AI, LLC</p>
            <p class="text-sm text-gray-500 mt-2">üîí Private Tool for Roy & Cindy</p>
        </div>
    </footer>

    <script>
        // ===== CONFIGURATION =====
        let selectedArea = 'all';
        let selectedType = 'all';
        let passholderMode = false;
        let dealLog = JSON.parse(localStorage.getItem('scannerDealLog') || '[]');

        // Check saved passholder preference
        if (localStorage.getItem('passholderMode') === 'true') {
            passholderMode = true;
        }

        // ===== HOTEL DATABASE WITH FULL IDENTIFICATION INFO =====
        const HOTELS = [
            // DISNEY DELUXE - 4 Star on Priceline, Bonnet Creek, NO resort fee
            { id: 'grand-floridian', name: "Grand Floridian Resort & Spa", icon: 'üëë', 
              area: 'bonnet-creek', type: 'deluxe', price: '$649+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Monorail', 'Walk to MK', 'Spa'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/grand-floridian-resort-and-spa/' },
            { id: 'polynesian', name: "Polynesian Village Resort", icon: 'üå∫',
              area: 'bonnet-creek', type: 'deluxe', price: '$599+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Monorail', 'Beach', 'Fireworks view'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/polynesian-resort/' },
            { id: 'contemporary', name: "Contemporary Resort", icon: 'üè¢',
              area: 'bonnet-creek', type: 'deluxe', price: '$499+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Monorail', 'Walk to MK', 'California Grill'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/contemporary-resort/' },
            { id: 'wilderness-lodge', name: "Wilderness Lodge", icon: 'üå≤',
              area: 'bonnet-creek', type: 'deluxe', price: '$399+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false, hint: '"Lodge" in name' },
              clues: ['Boat to MK', 'Geyser', 'Lodge theme'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/wilderness-lodge-resort/' },
            { id: 'animal-kingdom-lodge', name: "Animal Kingdom Lodge", icon: 'ü¶Å',
              area: 'bonnet-creek', type: 'deluxe', price: '$399+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false, hint: '"Lodge" in name' },
              clues: ['Savanna views', 'Animals', 'African dining'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/animal-kingdom-lodge/' },
            { id: 'beach-club', name: "Beach Club Resort", icon: 'üèñÔ∏è',
              area: 'bonnet-creek', type: 'deluxe', price: '$549+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Walk to Epcot', 'Stormalong Bay', 'Beach theme'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/beach-club-resort/' },
            { id: 'yacht-club', name: "Yacht Club Resort", icon: '‚õµ',
              area: 'bonnet-creek', type: 'deluxe', price: '$549+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Walk to Epcot', 'Stormalong Bay', 'Nautical theme'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/yacht-club-resort/' },
            { id: 'boardwalk', name: "BoardWalk Inn", icon: 'üé°',
              area: 'bonnet-creek', type: 'deluxe', price: '$499+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Walk to Epcot', 'Walk to HS', 'Entertainment'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/boardwalk-inn/' },
            { id: 'riviera', name: "Riviera Resort", icon: 'üèõÔ∏è',
              area: 'bonnet-creek', type: 'deluxe', price: '$449+', apDiscount: '30-35%',
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: false },
              clues: ['Skyliner hub', 'European style', 'Rooftop dining'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/riviera-resort/' },
              
            // DISNEY MODERATE - 3.5 Star on Priceline, Bonnet Creek, NO resort fee
            { id: 'caribbean-beach', name: "Caribbean Beach Resort", icon: 'üèùÔ∏è',
              area: 'bonnet-creek', type: 'moderate', price: '$249+', apDiscount: '25-30%',
              priceline: { stars: 3.5, location: 'Bonnet Creek', resortFee: false },
              clues: ['Skyliner access', 'Beach', 'Island theme'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/caribbean-beach-resort/' },
            { id: 'coronado', name: "Coronado Springs Resort", icon: 'üåµ',
              area: 'bonnet-creek', type: 'moderate', price: '$259+', apDiscount: '25-30%',
              priceline: { stars: 3.5, location: 'Bonnet Creek', resortFee: false },
              clues: ['Gran Destino Tower', 'Convention ctr', 'Southwest theme'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/coronado-springs-resort/' },
            { id: 'port-orleans-riverside', name: "Port Orleans Riverside", icon: 'üö£',
              area: 'bonnet-creek', type: 'moderate', price: '$269+', apDiscount: '25-30%',
              priceline: { stars: 3.5, location: 'Bonnet Creek', resortFee: false },
              clues: ['Boat to DS', 'Southern theme', 'Quiet'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/port-orleans-resort-riverside/' },
            { id: 'port-orleans-french', name: "Port Orleans French Quarter", icon: '‚öúÔ∏è',
              area: 'bonnet-creek', type: 'moderate', price: '$269+', apDiscount: '25-30%',
              priceline: { stars: 3.5, location: 'Bonnet Creek', resortFee: false },
              clues: ['Boat to DS', 'NOLA theme', 'Beignets'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/port-orleans-resort-french-quarter/' },
              
            // DISNEY VALUE - 3 Star on Priceline, Bonnet Creek, NO resort fee  
            { id: 'pop-century', name: "Pop Century Resort", icon: 'üìº',
              area: 'bonnet-creek', type: 'value', price: '$169+', apDiscount: '20-25%',
              priceline: { stars: 3, location: 'Bonnet Creek', resortFee: false },
              clues: ['Skyliner access', 'Pop culture', 'Giant icons'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/pop-century-resort/' },
            { id: 'art-of-animation', name: "Art of Animation Resort", icon: 'üé®',
              area: 'bonnet-creek', type: 'value', price: '$189+', apDiscount: '20-25%',
              priceline: { stars: 3, location: 'Bonnet Creek', resortFee: false },
              clues: ['Skyliner access', 'Family suites', 'Animation theme'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/art-of-animation-resort/' },
            { id: 'all-star-movies', name: "All-Star Movies Resort", icon: 'üé¨',
              area: 'bonnet-creek', type: 'value', price: '$149+', apDiscount: '20-25%',
              priceline: { stars: 3, location: 'Bonnet Creek', resortFee: false },
              clues: ['Bus only', 'Movie themes', 'Giant Buzz/Woody'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/all-star-movies-resort/' },
            { id: 'all-star-music', name: "All-Star Music Resort", icon: 'üéµ',
              area: 'bonnet-creek', type: 'value', price: '$149+', apDiscount: '20-25%',
              priceline: { stars: 3, location: 'Bonnet Creek', resortFee: false },
              clues: ['Bus only', 'Music themes', 'Family suites available'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/all-star-music-resort/' },
            { id: 'all-star-sports', name: "All-Star Sports Resort", icon: '‚öΩ',
              area: 'bonnet-creek', type: 'value', price: '$139+', apDiscount: '20-25%',
              priceline: { stars: 3, location: 'Bonnet Creek', resortFee: false },
              clues: ['Bus only', 'Sports themes', 'Cheapest Disney'],
              roomOnly: true,
              bookUrl: 'https://disneyworld.disney.go.com/resorts/all-star-sports-resort/' },
              
            // PARTNER HOTELS - Various stars, Disney Springs area, HAS resort fee
            { id: 'swan', name: "Walt Disney World Swan", icon: 'ü¶¢',
              area: 'bonnet-creek', type: 'partner', price: '$299+', apDiscount: null,
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: true, feeAmount: '$35' },
              clues: ['Walk to Epcot', 'Walk to HS', 'Marriott'],
              roomOnly: true,
              bookUrl: 'https://www.marriott.com/en-us/hotels/mcowh-walt-disney-world-swan/overview/' },
            { id: 'dolphin', name: "Walt Disney World Dolphin", icon: 'üê¨',
              area: 'bonnet-creek', type: 'partner', price: '$289+', apDiscount: null,
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: true, feeAmount: '$35' },
              clues: ['Walk to Epcot', 'Walk to HS', 'Sheraton'],
              roomOnly: true,
              bookUrl: 'https://www.marriott.com/en-us/hotels/mcodo-walt-disney-world-dolphin/overview/' },
            { id: 'hilton-lbv', name: "Hilton Orlando Buena Vista Palace", icon: 'üè®',
              area: 'disney-springs', type: 'partner', price: '$189+', apDiscount: null,
              priceline: { stars: 4, location: 'Disney Springs', resortFee: true },
              clues: ['Walk to DS', 'Spa', 'Multiple restaurants'],
              roomOnly: true,
              bookUrl: 'https://www.hilton.com/en/hotels/mcoobhh-hilton-orlando-buena-vista-palace/' },
            { id: 'hilton-bonnet', name: "Hilton Orlando Bonnet Creek", icon: 'üåü',
              area: 'bonnet-creek', type: 'partner', price: '$249+', apDiscount: null,
              priceline: { stars: 4, location: 'Bonnet Creek', resortFee: true },
              clues: ['Lazy river', 'Golf course', 'Walk to Waldorf'],
              roomOnly: true,
              bookUrl: 'https://www.hilton.com/en/hotels/mcobchh-hilton-orlando-bonnet-creek/' },
            { id: 'doubletree-ds', name: "DoubleTree Suites Disney Springs", icon: 'üç™',
              area: 'disney-springs', type: 'partner', price: '$179+', apDiscount: null,
              priceline: { stars: 3.5, location: 'Disney Springs', resortFee: true },
              clues: ['All suites', 'Free cookies', 'Walk to DS'],
              roomOnly: true,
              bookUrl: 'https://www.hilton.com/en/hotels/mcoordt-doubletree-suites-by-hilton-orlando-disney-springs-area/' },
            { id: 'drury-plaza', name: "Drury Plaza Hotel Disney Springs", icon: 'üåü',
              area: 'disney-springs', type: 'partner', price: '$159+', apDiscount: null,
              priceline: { stars: 3.5, location: 'Disney Springs', resortFee: false },
              clues: ['Free breakfast', 'Free kickback', 'Great value'],
              roomOnly: true,
              bookUrl: 'https://www.druryhotels.com/locations/orlando-fl/drury-plaza-hotel-orlando-disney-springs-area' },
            { id: 'b-resort', name: "B Resort & Spa Disney Springs", icon: 'üíÜ',
              area: 'disney-springs', type: 'partner', price: '$149+', apDiscount: null,
              priceline: { stars: 4, location: 'Disney Springs', resortFee: true },
              clues: ['Walk to DS', 'Spa', 'Zero-entry pool'],
              roomOnly: true,
              bookUrl: 'https://www.bhotelsandresorts.com/b-resort-and-spa/' },
            { id: 'wyndham-ds', name: "Wyndham Garden Disney Springs", icon: 'üå≥',
              area: 'disney-springs', type: 'partner', price: '$129+', apDiscount: null,
              priceline: { stars: 3, location: 'Disney Springs', resortFee: true },
              clues: ['Near DS', 'Budget friendly', 'Free parking'],
              roomOnly: true,
              bookUrl: 'https://www.wyndhamhotels.com/wyndham-garden/lake-buena-vista-florida/wyndham-garden-lake-buena-vista-disney-springs-resort-area/overview' },
              
            // UNIVERSAL AREA
            { id: 'doubletree-universal', name: "DoubleTree Universal Entrance", icon: 'üé¢',
              area: 'universal', type: 'partner', price: '$179+', apDiscount: null,
              priceline: { stars: 4, location: 'Universal Orlando', resortFee: true },
              clues: ['Walk to Universal', 'Free cookies', 'Near CityWalk'],
              roomOnly: true,
              bookUrl: 'https://www.hilton.com/en/hotels/mcoundt-doubletree-by-hilton-at-the-entrance-to-universal-orlando/' },
              
            // LAKE BUENA VISTA
            { id: 'marriott-village', name: "Marriott Village Orlando", icon: 'üè°',
              area: 'lbv', type: 'partner', price: '$139+', apDiscount: null,
              priceline: { stars: 3, location: 'Lake Buena Vista North', resortFee: false },
              clues: ['3 hotels in 1', 'Free shuttle', 'Pool'],
              roomOnly: true,
              bookUrl: 'https://www.marriott.com/en-us/hotels/mcoov-marriott-village-at-lake-buena-vista/overview/' },
        ];

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', () => {
            // Set default dates (today + 30 days, 3 nights)
            const today = new Date();
            const checkin = new Date(today);
            checkin.setDate(today.getDate() + 30);
            const checkout = new Date(checkin);
            checkout.setDate(checkin.getDate() + 3);
            
            document.getElementById('checkin-date').value = formatDateInput(checkin);
            document.getElementById('checkout-date').value = formatDateInput(checkout);
            
            // Apply saved passholder mode
            if (passholderMode) {
                applyPassholderMode(true);
            }
            
            renderHotels();
            renderDealLog();
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });

        function formatDateInput(date) {
            return date.toISOString().split('T')[0];
        }

        // ===== PASSHOLDER MODE TOGGLE =====
        function togglePassholderMode() {
            passholderMode = !passholderMode;
            localStorage.setItem('passholderMode', passholderMode);
            applyPassholderMode(passholderMode);
            renderHotels();
            showToast(passholderMode ? 'üéüÔ∏è Passholder Mode ON - Room-only deals!' : 'üë• Regular Mode - All deals shown');
        }

        function applyPassholderMode(enabled) {
            const header = document.getElementById('main-header');
            const banner = document.getElementById('passholder-banner');
            const indicator = document.getElementById('passholder-indicator');
            const dot = document.getElementById('passholder-dot');
            const label = document.getElementById('passholder-label');
            const subtitle = document.getElementById('header-subtitle');
            const apButtons = document.getElementById('ap-scan-buttons');
            const apDiscounts = document.getElementById('ap-discounts-section');
            const scanTip = document.getElementById('scan-tip');
            const dateTip = document.getElementById('date-tip');
            const discountHeader = document.getElementById('discount-header');
            const hotelSubtitle = document.getElementById('hotel-subtitle');
            
            if (enabled) {
                header.classList.remove('scanner-gradient');
                header.classList.add('passholder-gradient');
                banner.classList.remove('hidden');
                indicator.classList.remove('bg-gray-600');
                indicator.classList.add('bg-green-500');
                dot.classList.remove('left-1');
                dot.classList.add('left-7');
                label.textContent = 'Passholder ON';
                subtitle.textContent = 'Room-only deals for Annual Passholders';
                apButtons.classList.remove('hidden');
                apDiscounts.classList.remove('hidden');
                scanTip.innerHTML = '<strong>üéüÔ∏è Passholder Tip:</strong> All deals below are ROOM-ONLY - no tickets included. Perfect for APs! Priceline/Hotwire mystery deals are also room-only.';
                dateTip.innerHTML = '<span>üí°</span><span>AP Tip: Sun-Thu stays get better discounts. Book 2+ weeks out for AP rates. Call 407-939-7675 for AP-specific pricing!</span>';
                discountHeader.textContent = 'AP Discount';
                hotelSubtitle.textContent = 'Disney resorts with AP discounts shown ‚Ä¢ Room-only deals only';
            } else {
                header.classList.add('scanner-gradient');
                header.classList.remove('passholder-gradient');
                banner.classList.add('hidden');
                indicator.classList.add('bg-gray-600');
                indicator.classList.remove('bg-green-500');
                dot.classList.add('left-1');
                dot.classList.remove('left-7');
                label.textContent = 'Passholder Mode';
                subtitle.textContent = 'Find secret hotel deals before anyone else';
                apButtons.classList.add('hidden');
                apDiscounts.classList.add('hidden');
                scanTip.innerHTML = '<strong>üéØ Pro Tip:</strong> After scanning, look for hotels matching the identifiers below. Use RoomRevealer to see which mystery hotel is which!';
                dateTip.innerHTML = '<span>üí°</span><span>Tip: Check 15 days before arrival for best deals. Book on Tuesdays for 16% savings!</span>';
                discountHeader.textContent = 'Key Clues';
                hotelSubtitle.textContent = 'Match mystery hotels to real hotels using these clues';
            }
        }

        // ===== COUNTDOWN =====
        function updateCountdown() {
            const now = new Date();
            const orlando = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
            let target = new Date(orlando);
            target.setHours(16, 0, 0, 0);
            if (orlando >= target) target.setDate(target.getDate() + 1);
            const diff = target - orlando;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            document.getElementById('countdown').textContent = 
                `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }

        // ===== FILTERS =====
        function toggleArea(area) {
            selectedArea = area;
            document.querySelectorAll('.area-chip').forEach(c => c.classList.remove('selected'));
            document.querySelector(`[data-area="${area}"]`).classList.add('selected');
            renderHotels();
        }

        function toggleType(type) {
            selectedType = type;
            document.querySelectorAll('.type-chip').forEach(c => c.classList.remove('selected'));
            document.querySelector(`[data-type="${type}"]`).classList.add('selected');
            renderHotels();
        }

        function getFilteredHotels() {
            return HOTELS.filter(h => {
                const areaMatch = selectedArea === 'all' || h.area === selectedArea;
                const typeMatch = selectedType === 'all' || h.type === selectedType;
                // In passholder mode, only show room-only deals (which is all of them in this case)
                // But prioritize Disney resorts with AP discounts
                return areaMatch && typeMatch;
            });
        }

        // ===== RENDER HOTELS =====
        function renderHotels() {
            let hotels = getFilteredHotels();
            
            // In passholder mode, sort by AP discount (highest first)
            if (passholderMode) {
                hotels = hotels.sort((a, b) => {
                    if (a.apDiscount && !b.apDiscount) return -1;
                    if (!a.apDiscount && b.apDiscount) return 1;
                    return 0;
                });
            }
            
            document.getElementById('hotel-count').textContent = hotels.length;
            
            const container = document.getElementById('hotel-list');
            if (hotels.length === 0) {
                container.innerHTML = '<div class="p-8 text-center text-gray-400">No hotels match your filters</div>';
                return;
            }
            
            container.innerHTML = hotels.map(h => `
                <div class="hotel-row grid grid-cols-12 gap-2 px-6 py-4 items-center cursor-pointer transition" onclick="window.open('${h.bookUrl}', '_blank')">
                    <div class="col-span-3 flex items-center gap-3">
                        <span class="text-2xl">${h.icon}</span>
                        <div>
                            <div class="font-bold text-gray-900 flex items-center gap-2">
                                ${h.name}
                                ${h.roomOnly ? '<span class="text-xs bg-green-100 text-green-700 px-1.5 py-0.5 rounded">Room Only</span>' : ''}
                            </div>
                            <div class="text-xs text-gray-500">${h.type.charAt(0).toUpperCase() + h.type.slice(1)}</div>
                        </div>
                    </div>
                    <div class="col-span-2">
                        <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold ${h.priceline.stars >= 4 ? 'bg-amber-100 text-amber-700' : h.priceline.stars >= 3.5 ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'}">
                            ${h.priceline.stars}‚≠ê
                        </span>
                    </div>
                    <div class="col-span-2 text-sm text-gray-600">${h.priceline.location}</div>
                    <div class="col-span-2">
                        ${passholderMode ? `
                            ${h.apDiscount ? `
                                <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-yellow-100 to-amber-100 text-amber-800 border border-amber-300">
                                    üéüÔ∏è ${h.apDiscount}
                                </span>
                            ` : `
                                <span class="text-xs text-gray-400">No AP discount</span>
                            `}
                        ` : `
                            <div class="flex flex-wrap gap-1">
                                ${h.priceline.resortFee 
                                    ? `<span class="text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded">Fee ${h.priceline.feeAmount || ''}</span>` 
                                    : `<span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded font-bold">NO Fee ‚úì</span>`}
                                ${h.priceline.hint ? `<span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">${h.priceline.hint}</span>` : ''}
                            </div>
                        `}
                    </div>
                    <div class="col-span-1 font-bold text-green-600">${h.price}</div>
                    <div class="col-span-2 text-right">
                        <button onclick="event.stopPropagation(); window.open('${h.bookUrl}', '_blank')" 
                            class="${passholderMode && h.apDiscount ? 'bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-600 hover:to-amber-600' : 'bg-purple-600 hover:bg-purple-700'} text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                            ${passholderMode && h.apDiscount ? 'üéüÔ∏è Book AP Rate' : 'Book Direct ‚Üí'}
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ===== SCANNING FUNCTIONS =====
        function getSearchDates() {
            const checkin = document.getElementById('checkin-date').value;
            const checkout = document.getElementById('checkout-date').value;
            const guests = document.getElementById('guests').value;
            const rooms = document.getElementById('rooms').value;
            
            if (!checkin || !checkout) {
                showToast('‚ö†Ô∏è Please select dates first!');
                return null;
            }
            return { checkin, checkout, guests, rooms };
        }

        function getAreaSearchTerm() {
            const areaMap = {
                'all': 'Orlando, FL',
                'bonnet-creek': 'Walt Disney World, FL',
                'disney-springs': 'Disney Springs, FL',
                'universal': 'Universal Orlando, FL',
                'lbv': 'Lake Buena Vista, FL'
            };
            return areaMap[selectedArea] || 'Orlando, FL';
        }

        function scanRoomRevealer() {
            const dates = getSearchDates();
            if (!dates) return;
            const url = `https://roomrevealer.com/orlando_fl/`;
            window.open(url, '_blank');
            showToast('üîÆ Opening RoomRevealer...');
        }

        function scanPriceline() {
            const dates = getSearchDates();
            if (!dates) return;
            const destination = encodeURIComponent(getAreaSearchTerm());
            const url = `https://www.priceline.com/stay/search/hotels/?destination=${destination}&rooms=${dates.rooms}&adults=${dates.guests}&checkin=${dates.checkin}&checkout=${dates.checkout}&express=1`;
            window.open(url, '_blank');
            showToast('üéØ Opening Priceline Express Deals...');
        }

        function scanHotwire() {
            const dates = getSearchDates();
            if (!dates) return;
            const destination = encodeURIComponent(getAreaSearchTerm());
            const ci = new Date(dates.checkin);
            const co = new Date(dates.checkout);
            const ciStr = `${ci.getMonth()+1}/${ci.getDate()}/${ci.getFullYear().toString().slice(-2)}`;
            const coStr = `${co.getMonth()+1}/${co.getDate()}/${co.getFullYear().toString().slice(-2)}`;
            const url = `https://www.hotwire.com/hotels/search?destination=${destination}&startDate=${ciStr}&endDate=${coStr}&rooms=${dates.rooms}&adults=${dates.guests}`;
            window.open(url, '_blank');
            showToast('üî• Opening Hotwire Hot Rates...');
        }

        function scanAll() {
            const dates = getSearchDates();
            if (!dates) return;
            showToast('‚ö° Opening all 3 sites...');
            setTimeout(() => scanRoomRevealer(), 0);
            setTimeout(() => scanPriceline(), 500);
            setTimeout(() => scanHotwire(), 1000);
        }

        // ===== DEAL LOG =====
        function showAddDealModal() {
            document.getElementById('add-deal-modal').classList.remove('hidden');
        }

        function hideAddDealModal(e) {
            if (!e || e.target === e.currentTarget) {
                document.getElementById('add-deal-modal').classList.add('hidden');
            }
        }

        function saveDeal() {
            const deal = {
                id: Date.now(),
                hotel: document.getElementById('deal-hotel').value,
                price: document.getElementById('deal-price').value,
                source: document.getElementById('deal-source').value,
                dates: document.getElementById('deal-dates').value,
                notes: document.getElementById('deal-notes').value,
                timestamp: new Date().toLocaleString(),
                passholder: passholderMode
            };
            
            if (!deal.hotel || !deal.price) {
                showToast('‚ö†Ô∏è Please enter hotel and price');
                return;
            }
            
            dealLog.unshift(deal);
            localStorage.setItem('scannerDealLog', JSON.stringify(dealLog));
            renderDealLog();
            hideAddDealModal();
            showToast('‚úÖ Deal saved!');
            
            document.getElementById('deal-hotel').value = '';
            document.getElementById('deal-price').value = '';
            document.getElementById('deal-dates').value = '';
            document.getElementById('deal-notes').value = '';
        }

        function deleteDeal(id) {
            dealLog = dealLog.filter(d => d.id !== id);
            localStorage.setItem('scannerDealLog', JSON.stringify(dealLog));
            renderDealLog();
            showToast('Deleted');
        }

        function renderDealLog() {
            const container = document.getElementById('deal-log');
            if (dealLog.length === 0) {
                container.innerHTML = '<p class="text-gray-400 text-center py-8">No deals logged yet. Find a deal and click "Add Deal" to track it!</p>';
                return;
            }
            
            container.innerHTML = dealLog.map(d => `
                <div class="bg-gray-50 rounded-xl p-4 flex items-start gap-4 animate-in">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            ${d.passholder ? '<span class="text-lg">üéüÔ∏è</span>' : ''}
                            <span class="font-bold text-gray-900">${escHtml(d.hotel)}</span>
                            <span class="text-lg font-bold text-green-600">${escHtml(d.price)}</span>
                        </div>
                        <div class="text-sm text-gray-500">${escHtml(d.source)} ‚Ä¢ ${escHtml(d.dates)}</div>
                        ${d.notes ? `<div class="text-sm text-gray-400 mt-1 bg-gray-100 px-2 py-1 rounded">${escHtml(d.notes)}</div>` : ''}
                        <div class="text-xs text-gray-300 mt-2">${d.timestamp}</div>
                    </div>
                    <button onclick="deleteDeal(${d.id})" class="text-red-400 hover:text-red-600 text-xl">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // ===== UTILITIES =====
        function escHtml(str) {
            if (!str) return '';
            return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 2500);
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') hideAddDealModal();
        });
    </script>
</body>
</html>
